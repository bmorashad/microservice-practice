#/bin/bash

now=$(date +'%d-%m-%y-%H:%M')
if [ "$1" = "linkerd" ]; then
  meshName="linkerd"
else
  meshName="istio"
fi

ing=$(kubectl get ing -A | tail -n +2 | rg "$meshName" | awk '{print $5}')
mesh=$(kubectl get ing -A | tail -n +2 | rg "$meshName" | awk '{print $1}' | rg ".*" -r "$meshName")
resultDashboardFileName="$mesh-results/dashboard/$mesh-results--epoch:$now.html"
./k6 run load_test.js --address localhost:6566 -e HOST=$ing -e MESH=$mesh --out dashboard=report=$resultDashboardFileName

